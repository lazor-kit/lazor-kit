# useWallet Hook

The `useWallet` hook is the primary interface for interacting with LazorKit wallets in React applications.

## Import

```tsx
import { useWallet } from '@lazorkit/wallet';
```

## Usage

```tsx
function WalletComponent() {
  const {
    // State
    smartWalletPubkey,
    isConnected,
    isLoading,
    isConnecting,
    isSigning,
    error,
    account,

    // Actions
    connect,
    disconnect,
    reconnect,
    signTransaction,
    signAndSendTransaction,
    createPasskeyOnly,
    createSmartWalletOnly,
  } = useWallet();

  // Your component logic here
}
```

## State Properties

### `smartWalletPubkey`
- **Type**: `PublicKey | null`
- **Description**: The public key of the connected smart wallet
- **Example**: 
```tsx
if (smartWalletPubkey) {
  console.log('Wallet address:', smartWalletPubkey.toString());
}
```

### `isConnected`
- **Type**: `boolean`
- **Description**: Whether a wallet is currently connected (`!!account`)

### `isLoading`
- **Type**: `boolean`
- **Description**: General loading state (`isConnecting || isSigning`)

### `isConnecting`
- **Type**: `boolean`
- **Description**: Whether a connection operation is in progress

### `isSigning`
- **Type**: `boolean`
- **Description**: Whether a transaction signing operation is in progress

### `error`
- **Type**: `Error | null`
- **Description**: The last error that occurred, if any

### `account`
- **Type**: `WalletAccount | null`
- **Description**: Complete wallet account information when connected

## Action Methods

### `connect()`
- **Type**: `() => Promise<WalletAccount>`
- **Description**: Connects to a wallet. First tries auto-reconnection with stored credentials, then falls back to new connection dialog
- **Returns**: Promise resolving to wallet account information

```tsx
const handleConnect = async () => {
  try {
    const account = await connect();
    console.log('Connected to:', account.smartWallet);
  } catch (error) {
    console.error('Connection failed:', error);
  }
};
```

### `disconnect()`
- **Type**: `() => Promise<void>`
- **Description**: Disconnects the wallet while preserving communication handler for future reconnection

```tsx
const handleDisconnect = async () => {
  try {
    await disconnect();
    console.log('Disconnected successfully');
  } catch (error) {
    console.error('Disconnect failed:', error);
  }
};
```

### `reconnect()`
- **Type**: `() => Promise<WalletAccount>`
- **Description**: Manually reconnects using stored credentials

```tsx
const handleReconnect = async () => {
  try {
    const account = await reconnect();
    console.log('Reconnected successfully');
  } catch (error) {
    if (error.code === 'NO_STORED_CREDENTIALS') {
      console.log('No stored credentials found');
    }
  }
};
```

### `signTransaction()`
- **Type**: `(instruction: TransactionInstruction) => Promise<Transaction>`
- **Description**: Signs a transaction instruction without sending it

```tsx
const handleSign = async () => {
  const instruction = SystemProgram.transfer({
    fromPubkey: smartWalletPubkey!,
    toPubkey: new PublicKey('...'),
    lamports: LAMPORTS_PER_SOL * 0.1,
  });

  try {
    const signedTx = await signTransaction(instruction);
    // Handle the signed transaction
  } catch (error) {
    console.error('Signing failed:', error);
  }
};
```

### `signAndSendTransaction()`
- **Type**: `(instruction: TransactionInstruction) => Promise<string>`
- **Description**: Signs and sends a transaction instruction
- **Returns**: Promise resolving to transaction signature

```tsx
const handleTransfer = async () => {
  const instruction = SystemProgram.transfer({
    fromPubkey: smartWalletPubkey!,
    toPubkey: new PublicKey('...'),
    lamports: LAMPORTS_PER_SOL * 0.1,
  });

  try {
    const signature = await signAndSendTransaction(instruction);
    console.log('Transaction sent:', signature);
  } catch (error) {
    console.error('Transaction failed:', error);
  }
};
```

### `createPasskeyOnly()`
- **Type**: `() => Promise<ConnectResponse>`
- **Description**: Creates only a passkey without deploying a smart wallet
- **Returns**: Promise resolving to passkey data for later wallet creation

```tsx
const handleCreatePasskey = async () => {
  try {
    const passkeyData = await createPasskeyOnly();
    console.log('Passkey created:', passkeyData.credentialId);
    // Store passkeyData for later use
  } catch (error) {
    console.error('Passkey creation failed:', error);
  }
};
```

### `createSmartWalletOnly()`
- **Type**: `(passkeyData: ConnectResponse) => Promise<{smartWalletAddress: string, account: WalletAccount}>`
- **Description**: Creates a smart wallet using previously created passkey data

```tsx
const handleCreateWallet = async (passkeyData) => {
  try {
    const { smartWalletAddress, account } = await createSmartWalletOnly(passkeyData);
    console.log('Smart wallet created:', smartWalletAddress);
  } catch (error) {
    console.error('Wallet creation failed:', error);
  }
};
```

## Common Patterns

### Connection with Auto-Reconnection

```tsx
const handleConnect = async () => {
  try {
    // connect() automatically tries reconnection first
    const account = await connect();
    console.log('Connected:', account.smartWallet);
  } catch (error) {
    switch (error.code) {
      case 'NO_STORED_CREDENTIALS':
        console.log('First time user');
        break;
      case 'INVALID_CREDENTIALS':
        console.log('Credentials corrupted - cleared automatically');
        break;
      default:
        console.error('Connection failed:', error);
    }
  }
};
```

### Step-by-Step Wallet Creation

```tsx
const [passkeyData, setPasskeyData] = useState(null);
const [step, setStep] = useState('idle'); // 'idle' | 'passkey' | 'wallet'

const handleStepByStep = async () => {
  try {
    // Step 1: Create passkey
    setStep('passkey');
    const passkey = await createPasskeyOnly();
    setPasskeyData(passkey);
    
    // Step 2: Create wallet (could be done later)
    setStep('wallet');
    const { account } = await createSmartWalletOnly(passkey);
    
    setStep('idle');
    console.log('Wallet ready:', account.smartWallet);
  } catch (error) {
    setStep('idle');
    console.error('Step failed:', error);
  }
};
```

### Transaction with Loading States

```tsx
const handleTransfer = async () => {
  if (!smartWalletPubkey || isSigning) return;

  const instruction = SystemProgram.transfer({
    fromPubkey: smartWalletPubkey,
    toPubkey: new PublicKey('...'),
    lamports: LAMPORTS_PER_SOL * 0.1,
  });

  try {
    const signature = await signAndSendTransaction(instruction);
    console.log('Transfer completed:', signature);
  } catch (error) {
    console.error('Transfer failed:', error);
  }
};

return (
  <button 
    onClick={handleTransfer} 
    disabled={!smartWalletPubkey || isSigning}
  >
    {isSigning ? 'Sending...' : 'Transfer SOL'}
  </button>
);
```

## Type Definitions

### WalletAccount

```typescript
interface WalletAccount {
  publicKey: string;          // Passkey public key
  smartWallet: string;        // Smart wallet address (base58)
  isConnected: boolean;       // Connection status
  isCreated: boolean;         // Whether wallet was newly created
}
```

### ConnectResponse

```typescript
interface ConnectResponse {
  publicKey: string;          // Base64 encoded public key
  credentialId: string;       // Passkey credential ID
  isCreated: boolean;         // Whether credential was newly created
  connectionType: 'create' | 'get'; // Connection type
  timestamp: number;          // Response timestamp
}
```
